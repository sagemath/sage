cd src

export PIP_NO_INDEX=true
export PIP_FIND_LINKS="file://$SAGE_SPKG_WHEELS"

# We ignore the setting of SAGE_WHEELS here because the
# modularized distributions all need a sage_setup wheel.

# First build the sdist, then build the wheel from the sdist.
# https://pypa-build.readthedocs.io/en/latest/#python--m-build
# (Important because sagemath-objects uses MANIFEST.in for filtering.)
# Do not install the wheel.
DIST_DIR="$(mktemp -d)"
python3 -m build --outdir "$DIST_DIR"/dist . || sdh_die "Failure building sdist and wheel"

if [ "$SAGE_EDITABLE" = yes ]; then
    sdh_pip_editable_install .
    if [ "$SAGE_WHEELS" = yes ]; then
        sdh_build_and_store_wheel --no-isolation .
    fi
else
    wheel=$(cd "$DIST_DIR" && sdh_store_and_pip_install_wheel . >&2 && echo $wheel)
fi

ls -l "$wheel"
